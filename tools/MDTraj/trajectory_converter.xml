<tool id="mdtraj_traj_converter" name="Trajectory converter" version="1.9.1">
    <description>convert gromacs trr and gro formats to dcd and pdb formats</description>
    <requirements>
        <requirement type="package" version="1.9.1">mdtraj</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[

        ln -s '$input_file' ./input.${input_format} &&
        mdconvert ./input.${input_format} ./output.${output_format} &&
        cp ./output.${output_format} $output
        
    

    ]]></command>
    <inputs>

        <!-- #if $input_format == 'dcd':
            #blah
        #end if
        #if $input_format == 'trr' or $input_format == 'xtc':
            mdconvert -o $dcdout ./inp.${input_format} &&
        #endif -->


        <conditional name="input">
            <param name="input_format" type="select" label="File format of input">
                <option value="trr">TRR file</option>
                <option value="xtc">XTC file</option>
                <option value="dcd">DCD file</option>
            </param>
            <when value="trr">
                <param argument="input_file" type="data" format='trr' label=""/>
            </when>
            <when value="xtc">
                <param argument="input_file" type="data" format='xtc' label=""/>
            </when>
            <when value="dcd">
                <param argument="input_file" type="data" format='dcd' label=""/>
                <!-- <param name="gmx_output" type="select" label="File format of GROMACS output">
                    <option value="trr">TRR file</option>
                    <option value="xtc">XTC file</option>
                </param> -->
            </when>
        </conditional>

        <!-- <param argument="input" type="data" label="Input "/> -->
        <param argument="output_format" type="select" label="Output">
            <option value="trr">TRR file</option>
            <option value="xtc">XTC file</option>
            <option value="dcd">DCD file</option>
        </param>

        <!-- <param name="conversion_direction" type="select">
            <option value="dcd_gmx">DCD to TRR/XTC</option>
            <option value="gmx_dcd">TRR/XTC to DCD</option>
        </param> -->
        
        <!-- <param argument="trr_input" type="data" format='trr' label="TRR trajectory file."/> -->
    </inputs>
    <outputs>
        <!-- <data name="output" /> -->
        <data name="output" format="dcd">
            <filter>output_format == 'dcd'</filter>
        </data>
        <data name="output" format="xtc">
            <filter>output_format == 'xtc'</filter>
        </data>
        <data name="output" format="trr">
            <filter>output_format == 'trr'</filter>
        </data>
        <!-- <data name="output" format="dcd">
            <filter>input_format == 'trr' or input_format == 'xtc'</filter>
        </data>
        <data name="output" format="xtc">
            <filter>input_format == 'dcd' and gmx_output == 'xtc'</filter>
        </data>
        <data name="output" format="trr">
            <filter>input_format == 'dcd' and gmx_output == 'trr'</filter>
        </data> -->
    </outputs> 
    <tests>
        <test>
            <param name="input_format" value="xtc" />
            <param name="output_format" value="dcd" />
            <param name="input_file" value="traj.xtc" />
            <output name="output" file="traj.dcd"/>
                <!-- <assert_contents>
                    <has_line line="TITLE     LYSOZYME in water" />
                </assert_contents> -->
        </test>
    </tests>
    <help><![CDATA[
**What it does**
        
This tool converts GROMACS trajectory (trr) and structure (gro) files to pdb and dcd file formats.

_____


.. class:: infomark

**Input**

       - Trajectory file from GROMACS (trr).
       - Structure file from GROMACS (gro).
     
_____

        
.. class:: infomark

**Output**

       - Output files in PDB and DCD formats
    ]]></help>
    <citations>
        <citation type="doi">10.1016/j.bpj.2015.08.015</citation>
        <citation type="doi">10.1016/j.softx.2015.06.001</citation>
    </citations>
</tool>